# 現在のタスク

## 引き継ぎ情報

### プロジェクト概要
- **BrainBusters**: Slay the Spire風のローグライクカードゲーム（React Native/Expo）
- 500の哲学概念カードを使ったターン制バトル
- 50階ダンジョン、5体のボス

### 現在の状態
- バトルシステムは動作中
- 敵の攻撃は一体ずつ順次処理、メッセージはスタック表示
- 敵の行動予告（Intent）は削除済み
- 13カテゴリ別のカード効果テンプレート実装済み

### 核心的な問題（最優先で解決すべき）
**「ゲーム」になっていない** - カードを全部使えるので選択がなく、連打ゲームになっている
- エネルギーコスト0-3の幅が狭すぎる
- 手札6枚を全部使い切れてしまう
- → Phase 1のバランス調整で「手札6枚中3-4枚しか使えない」状態を目指す

### 重要ファイル
- `src/screens/BattleScreen.tsx` - バトル画面のメインロジック
- `src/data/cards.ts` - カード生成・効果テンプレート
- `src/types/game.ts` - ゲーム設定（GAME_CONFIG）
- `src/store/runStore.ts` - ゲーム状態管理
- `docs/RULEBOOK.md` - ルールブック

---

## 完了済み
- [x] 50階に拡張、26-50階用の新敵・エリート追加
- [x] 敵の行動予告（Intent）削除
- [x] 敵の順次処理・メッセージスタック表示
- [x] 13カテゴリ別カード効果テンプレート
- [x] 敵のバフ/デバフ処理実装
- [x] バランス調整（エネルギー4、HP70）

---

## 即時対応（優先度: 最高）
- [x] ボス撃破時の回復を100%に変更 ← 既に実装済みだった
- [x] ボスを10体に増加（5階ごと）← 新ボス5体追加
- [x] ストック枠を1枚→5枚に拡張
  - [x] 表示場所・表示方法の検討（他のカードと同じ表示にした）
  - [x] BattleCardコンポーネントで統一表示

---

## Phase 1: エネルギー・カードバランス（優先度: 高）
**問題**: カードを全部使い切れる → 選択がない → 連打ゲーム

- [x] コスト幅拡大（0-3 → 0-6）
- [x] 最大エネルギー増加（4 → 7）
- [x] 0コストカード削減（5%以下に）
- [x] 高コスト・高威力カード追加（コスト4-6で45-120ダメージ）

**目標達成**: 手札6枚中3-4枚しか使えない → 毎ターン選択が必要

---

## Phase 2: 難易度調整（優先度: 高）
- [ ] 敵のダメージ2倍
- [ ] 敵のHP1.5倍
- [ ] 「防御しないと死ぬ」緊張感の確認

---

## Phase 3: タグ・コンボシステム（優先度: 中）✅ 完了

### Phase 3-1: データ基盤 ✅
- [x] 型定義（src/types/tags.ts）
- [x] 著者マスター（src/data/authors.ts）- 20名
- [x] 関係性データ（src/data/relations.ts）- 21組
- [x] Card型拡張（src/types/game.ts）
- [x] cards.tsで自動タグ解決（authorId）

### Phase 3-2: コンボエンジン ✅
- [x] コンボ定義（src/data/combos.ts）- 14種
- [x] コンボ判定（src/utils/comboDetection.ts）

### Phase 3-3: 演出・UI ✅
- [x] コンボ演出（src/components/ComboDisplay.tsx）
- [x] BattleScreen統合

### 設計書
- `/Users/hirokitakamura/.claude/plans/soft-waddling-matsumoto.md`

---

## Phase 4: リスク/リターン（優先度: 中）
- [ ] HPコストカード（HP消費で強力効果）
- [ ] 条件付きカード（HP50%以下で発動など）
- [ ] ギャンブルカード（ランダム効果）

---

## その他
- [ ] ショップ機能充実
- [ ] 図鑑機能
- [ ] レリック効果の確認・修正

---

## 未来機能（UI/UX改善）
- [ ] カード表示の大型化
  - カード1枚1枚に画像を入れる予定
  - 画像を活かすため大きく表示したい
- [ ] カルーセル型カード選択UI
  - 3D回転式でカードをスクロール選択
  - 中央のカードが大きく表示される
  - 左右のカードは小さく奥に見える演出

## 未来機能（ゲームコンテンツ）
- [ ] 敵キャラを哲学的テーマ化
  - 例: 「意識とは何か」「クオリア」「生老病死」
  - 哲学的な問いや概念を敵として具現化
  - カードの概念と関連付けてシナジーを作る

## 未来機能（敵表示改善）
- [ ] 敵キャラのサイズ拡大
- [ ] HPバーの視認性向上（見づらい）

---

## メモ

### 核心的な問題
> 現状は「カードを出す作業」であり「ゲーム」ではない

### バランス調整の指針（実装済み）
- 最大エネルギー: 7
- コスト分布: 0(5%), 1(15-25%), 2(20-30%), 3(20-30%), 4(20%), 5(15%), 6(5%)
- 効果値: コスト6で90-120ダメージ
- 結果: 「攻撃か防御か」の判断が毎ターン必要

### ストック5枚化の狙い
- 「今使うか、貯めるか」の判断が毎ターン発生
- コンボ用カードを複数貯めておく戦略が可能に
- Phase 3の概念タグコンボとの相乗効果を期待
